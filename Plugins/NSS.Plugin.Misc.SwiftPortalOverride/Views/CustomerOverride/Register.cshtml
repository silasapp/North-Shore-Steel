@using Nop.Web.Models.Customer
@using Nop.Services.Customers
@using NSS.Plugin.Misc.SwiftCore.Helpers;
@model RegisterModel
@{
    Layout = "";
    //Html.AddCssFileParts("~/Plugins/Misc.SwiftPortalOverride/Content/customstyle.css");

}
@{
    Layout = "_ColumnsOne";

    //title
    Html.AddTitleParts(T("PageTitle.Register").Text);
    //page class
    Html.AppendPageCssClassParts("html-registration-page");
}


<style>
    .text-left > input {
        width: 100% !important;
        font-style: italic !important;
        font-size: 14px;
        background: #f6f6f6 0% 0% no-repeat padding-box !important;
        opacity: 1;
        /*border: none;*/
        font: italic normal normal 14px/24px "Exo 2";
        letter-spacing: 0px;
        color: #aaaaaa;
        opacity: 1;
    }

    .ui-dialog.ui-corner-all.ui-widget.ui-widget-content.ui-front.ui-draggable.ui-resizable {
        width: 67rem !important;
        margin: auto;
        position: relative !important;
        top: -100rem !important;
    }
</style>

<div class="page registration-page">
    <div class="page-title">
        <h1>REGISTER</h1>
    </div>

    <div class="page-body">
        <form asp-route="Register" asp-route-returnurl="@Context.Request.Query["ReturnUrl"]" method="post" autocomplete="off">
            <div asp-validation-summary="ModelOnly" class="message-error"></div>
            <div class="fieldset">

                <div class="form-fields">
                    <div class="title">
                        <strong>PERSONAL INFORMATION</strong>
                    </div>

                    <div>
                        <div class="form-group row">
                            @if (Model.FirstNameEnabled)
                            {
                                <div class="col-md-6 col-sm-12 col-xs-12 text-left mb-3">
                                    <label asp-for="FirstName">First Name</label>
                                    <nop-required />
                                    <input asp-for="FirstName" class="form-control custom-input" />
                                    <span asp-validation-for="FirstName" style="display:flex;"></span>
                                </div>
                            }


                            @if (Model.LastNameEnabled)
                            {
                                <div class="col-md-6 col-sm-12 col-xs-12 text-left">
                                    <label asp-for="LastName">Last Name</label>
                                    <nop-required />
                                    <input asp-for="LastName" class="form-control custom-input" />
                                    <span asp-validation-for="LastName" style="display: flex;"></span>
                                </div>
                            }



                        </div>


                        <div class="form-group row">

                            <div class="col-md-6 col-sm-12 col-xs-12 text-left mb-3">
                                <label asp-for="Email">Work Email</label>
                                <nop-required />
                                <input asp-for="Email" class="form-control custom-input" />
                                <span asp-validation-for="Email" style="display:flex;"></span>
                            </div>

                            @if (Model.EnteringEmailTwice)
                            {
                                <div class="col-md-6 col-sm-12 col-xs-12 text-left">
                                    <label asp-for="ConfirmEmail">Confirm Email</label>
                                    <nop-required />
                                    <input asp-for="ConfirmEmail" class="form-control custom-input" />
                                    <span asp-validation-for="ConfirmEmail" style="display:flex;"></span>
                                </div>
                            }

                        </div>


                        <div class="form-group row">

                            <div class="col-md-6 col-sm-12 col-xs-12 text-left mb-3">
                                <label asp-for="Password">Set Password</label>
                                <nop-required />
                                <input asp-for="Password" class="form-control custom-input" />
                                <span asp-validation-for="Password" style="display:flex;"></span>

                            </div>

                            <div class="col-md-6 col-sm-12 col-xs-12 text-left">
                                <label asp-for="ConfirmPassword">Confirm Password</label>
                                <nop-required />
                                <input asp-for="ConfirmPassword" class="form-control custom-input" />
                                <span asp-validation-for="ConfirmPassword" style="display:flex;"></span>
                            </div>
                            @if (Model.DisplayCaptcha)
                            {
                                <nop-captcha />
                            }

                        </div>


                        <div class="form-group row">
                            @if (Model.CompanyEnabled)
                            {
                                <div class="col-md-6 col-sm-12 col-xs-12 text-left mb-3">
                                    <label asp-for="Company">Company Name</label>
                                    <nop-required />
                                    <input asp-for="Company" class="form-control custom-input" />
                                    <span asp-validation-for="Company" style="display:flex;"></span>

                                    @{
                                        var isExistingCustomerCtrl = Model.CustomerAttributes.Where(x => x.Name == "Existing Customer").FirstOrDefault();
                                    }
                                    @if (isExistingCustomerCtrl != null)
                                    {
                                        var controlId = $"{NopCustomerServicesDefaults.CustomerAttributePrefix}{isExistingCustomerCtrl.Id}";
                                        <ul class="option-list">
                                            @foreach (var attributeValue in isExistingCustomerCtrl.Values)
                                            {
                                                <li>
                                                    <input id="@(controlId)_@(attributeValue.Id)" type="checkbox" name="@(controlId)" value="@attributeValue.Id" checked="@attributeValue.IsPreSelected" />
                                                    <label for="@(controlId)_@(attributeValue.Id)" id="current-customer">I am a current customer</label>
                                                </li>
                                            }
                                        </ul>
                                    }

                                </div>
                            }

                            @if (Model.PhoneEnabled)
                            {
                                <div class="col-md-6 col-sm-12 col-xs-12 text-left">
                                    <label asp-for="Phone">Phone Number</label>
                                    <nop-required />
                                    <input asp-for="Phone" class="form-control custom-input" />
                                    <span asp-validation-for="Phone" style="display:flex;"></span>
                                </div>
                            }

                        </div>

                    </div>
                </div>
            </div>



            @if (Model.CustomerAttributes.Count > 0)
            {
                <div class="fieldset">
                    <div class="form-fields">
                        <div class="title">
                            <strong>OTHER INFORMATION</strong>
                        </div>
                        <div class="row">
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div style="margin-bottom: 2em">
                                    @foreach (var attribute in Model.CustomerAttributes)
                                    {
                                        var controlId = $"{NopCustomerServicesDefaults.CustomerAttributePrefix}{attribute.Id}";
                                        var textPrompt = attribute.Name;

                                        @if (attribute.Name == Constants.HearAboutUsAttribute)
                                        {
                                            <label>How did you hear about us?</label>
                                            <nop-required />
                                            <select name="@(controlId)" id="@(controlId)" class="form-control custom-input" onchange="otherMethodCheck(this);">
                                                @if (!attribute.IsRequired)
                                                {
                                                    <option value="0"> ---</option>
                                                }
                                                @foreach (var attributeValue in attribute.Values)
                                                {
                                                    <option selected="@attributeValue.IsPreSelected" value="@attributeValue.Id"> @attributeValue.Name </option>
                                                }
                                            </select>
                                        }
                                    }
                                </div>

                                <div style="margin-bottom: 2em">
                                    @foreach (var attribute in Model.CustomerAttributes)
                                    {
                                        var controlId = $"{NopCustomerServicesDefaults.CustomerAttributePrefix}{attribute.Id}";
                                        var textPrompt = attribute.Name;

                                        @if (attribute.Name == Constants.OtherAttribute)
                                        {
                                            <div id="other-method" style="display:none">
                                                <label> Let us know how you found us</label>
                                                <nop-required />
                                                <input name="@(controlId)" type="text" class="textbox form-control custom-input" id="@(controlId)" value="@(attribute.DefaultValue)" />
                                            </div>
                                        }
                                    }
                                </div>

                                <div>
                                    @foreach (var attribute in Model.CustomerAttributes)
                                    {
                                        var controlId = $"{NopCustomerServicesDefaults.CustomerAttributePrefix}{attribute.Id}";
                                        var textPrompt = attribute.Name;


                                        @if (attribute.Name == Constants.PreferredLocationIdAttribute)
                                        {
                                            <label>Preferred pickup location</label>
                                            <nop-required />
                                            <select name="@(controlId)" id="@(controlId)" class="form-control custom-input">
                                                @if (!attribute.IsRequired)
                                                {
                                                    <option value="0">---</option>
                                                }
                                                @foreach (var attributeValue in attribute.Values)
                                                {
                                                    <option selected="@attributeValue.IsPreSelected" value="@attributeValue.Id">@attributeValue.Name</option>
                                                }
                                            </select>
                                        }

                                    }
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                @foreach (var attribute in Model.CustomerAttributes)
                                {
                                    var controlId = $"{NopCustomerServicesDefaults.CustomerAttributePrefix}{attribute.Id}";
                                    var textPrompt = attribute.Name;
                                    @if (attribute.Name == Constants.ItemsForNextProjectAttribute)
                                    {
                                        <div>
                                            <label>How can we help?</label>
                                            <nop-required />
                                            <textarea id="@(controlId)" placeholder="What items are you considering for your next project?" class="form-control custom-input" name="@(controlId)">@(attribute.DefaultValue)</textarea>
                                        </div>
                                    }
                                }
                            </div>

                        </div>
                    </div>

                    @if (Model.AcceptPrivacyPolicyEnabled)
                    {
                        <script asp-location="Footer">
                                $(document).ready(function() {
                                    $('#register-button').on('click', function() {
                                        if ($('#accept-consent').is(':checked')) {
                                            //do some stuff
                                            return true;
                                        } else {
                                            //just show validation errors, don't post
                                            alert('@Html.Raw(JavaScriptEncoder.Default.Encode(T("Account.Fields.AcceptPrivacyPolicy.Required").Text))');
                                            return false;
                                        }
                                    });
                                });
                        </script>
                        <div class="accept-consent">
                            <label class=pure-material-checkbox>
                                <input id="accept-consent" type="checkbox" name="accept-consent" />
                                <span class="checkmark"></span>
                                @if (Model.AcceptPrivacyPolicyPopup)
                                {
                                    <a class="read" id="read-privacyinfo">Accept Terms and Privacy Policy</a>
                                    <script asp-location="Footer">
                            $(document).ready(function () {
                                $('#read-privacyinfo').on('click',
                                   function(e) {
	                            displayPopupContentFromUrl(
		                            '@Url.RouteUrl("TopicPopup", new {SystemName = "privacyinfo"})',
		                            '');
                            });
                            });
                                    </script>
                                }
                                else
                                {
                                    @*<a class="read" id="read-privacyinfo" href="@Url.RouteUrl("Topic", new {SeName = Html.GetTopicSeName("privacyinfo") })">@T("Account.Fields.AcceptPrivacyPolicy.Read")</a>*@
                                }
                            </label>
                        </div>
                    }

                    <div class="buttons">
                        <input type="submit" id="register-button" class="button-1 register-next-step-button" value="@T("Account.Register.Button")" name="register-button" />
                    </div>
                </div>
            }


            @if (Model.NewsletterEnabled)
            {
                <div class="fieldset">
                    <div class="form-fields" style="padding:1em;">
                        <div class="news-field" style="background-color: #fff;padding: 1em 0;">
                            <div class="title">
                                <strong>KEEP INFORMED</strong>
                            </div>
                            <div style="text-align:center">
                                <input asp-for="Newsletter" />
                                <label asp-for="Newsletter">Sign me up to your newsletter</label>
                                <span asp-validation-for="Newsletter"></span>
                            </div>
                        </div>
                    </div>
                </div>
            }



        </form>
        <div class="external-authentication">
            @await Component.InvokeAsync("ExternalMethods", "ExternalAuthentication")
        </div>
    </div>


</div>
<script>
    function otherMethodCheck(option) {
        let optionName = option.options[option.selectedIndex].text;
        if (optionName == "Other") {
            document.getElementById("other-method").style.display = "block";
        } else {
            document.getElementById("other-method").style.display = "none";
        }
    }
</script>