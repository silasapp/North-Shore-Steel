@inject IThemeContext themeContext
@using Nop.Web.Framework.Themes
@using NSS.Plugin.Misc.SwiftPortalOverride.Models

@model CompanyInvoiceListModel
@{
    Layout = "_ColumnsOne";
}
@{ var themeName = themeContext.WorkingThemeName; }
<div id="invoices" class="page orders-page">
    <div class=page-body>
        <div class="bg-white-shadow d-flex flex-row flex-wrap align-items-center mb-3 p-4">
            <label class="h2-primary my-4">CREDIT SUMMARY</label>

            <div class="d-flex flex-row flex-wrap flex-fill justify-content-around">
                <div class="d-flex flex-column mx-3 my-1">
                    <label class="fs12-default mb-2">Credit Limit</label>
                    <label class="h5-default mb-0 ml-2">$10,000</label>
                </div>
                <div class="d-flex flex-column mx-3 my-1">
                    <label class="fs12-default mb-2">Total Open Invoices</label>
                    <label class="h5-default mb-0 ml-2">$3,024.50</label>
                </div>
                <div class="d-flex flex-column mx-3 my-1">
                    <label class="fs12-default mb-2">Total Past Due</label>
                    <label class="h5-danger mb-0 ml-2">$1,334.87</label>
                </div>
                <div class="d-flex flex-column mx-3 my-1">
                    <label class="fs12-default mb-2">Open Credit</label>
                    <label class="h5-default mb-0 ml-2">$2,000.00</label>
                </div>
            </div>

        </div>

        <div class="orders-search-block bg-white-shadow" id=ordersTableBlock role="tabpanel" aria-labelledby="ordersTableBlock">
            <div>
                <div class="orders-title">SEARCH INVOICES</div>
                <div class="orders-export cursor-pointer" v-on:click="isSearchExpanded = !isSearchExpanded;">
                    <img class="collapse-icon" v-bind:class="{'down': isSearchExpanded}" id="collapseIcon"
                         src="~/Themes/@(themeName)/Content/assets/icn-expand.svg" alt="" />
                </div>
            </div>

            <div v-show="isSearchExpanded" class="row m-0 py-0">
                <div class="col-lg-2 col-md-6 col-sm-6 d-flex flex-column my-3">
                    <label for=orderFromDate>Order Dates</label>
                    <div class="input-with-icon">
                        <input class=nss-form-control type="text" v-model="fromDate" id="datepicker" autocomplete="off" placeholder="From">
                        <img src="~/Themes/@(themeName)/Content/assets/icn-cal-range.svg" alt="">
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6d-flex flex-column my-3 py-0">
                    <label for=orderToDate> &nbsp;</label>
                    <div class="input-with-icon">
                        <input class=nss-form-control type="text" v-model="toDate" id="datepicker2" autocomplete="off" placeholder="To">
                        @*<input class=nss-form-control type="date" v-model="toDate" data-val=true placeholder="To" />*@
                        <img src="~/Themes/@(themeName)/Content/assets/icn-cal-range.svg" alt="">
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6 d-flex flex-column my-3 py-0">
                    <label for=purchaseOrder>Invoice #</label>
                    <input class="nss-form-control" type="text" v-model="invoiceId" placeholder="Enter...">
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6 d-flex flex-column my-3 py-0">
                    <label for=purchaseOrder>Order #</label>
                    <input class=nss-form-control type="text" v-model="orderId" placeholder="Enter...">
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6 d-flex flex-column my-3 py-0">
                    <label for=purchaseOrder>Purchase Order #</label>
                    <input class=nss-form-control type="text" v-model="poNo" placeholder="Enter...">
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6 d-flex flex-row-reverse align-items-end pl-lg-5 my-3 py-0">
                    <button class="nss-btn-default ml-lg-5 w-100 text-center" style=" padding: 10px 16px;" v-on:click="searchInvoices">Search</button>
                </div>
            </div>
        </div>
        <div class="d-flex flex-column p-4 bg-white-shadow">
            <div class="d-flex flex-row justify-content-between mb-3">
                <div>
                    <ul class="nav nav-pills mb-1" id=pills-tab role="tablist">
                        <li class=nav-item role="presentation" style=margin-right:.3em>
                            <a class="nav-link active" id=pills-home-tab data-toggle=pill
                               href=#pills-home role=tab aria-controls=pills-home
                               aria-selected=true v-on:click="isClosed = false; searchInvoices();">Open Invoices</a>
                        <li class=nav-item role="presentation">
                            <a class=nav-link id=pills-profile-tab
                               data-toggle=pill href=#pills-profile role=tab
                               aria-controls=pills-profile aria-selected=false v-on:click="isClosed = true; searchInvoices();">Closed Invoices</a>
                    </ul>
                </div>
                <label class="h4-primary"><img src="~/Themes/@(themeName)/Content/assets/icn-download.svg" alt="">Export</label>
            </div>
            <div id="invoice-grid" class="ml-4"></div>
        </div>
    </div>
</div>
@functions{

}

<script>
    var vm = new Vue({
        el: '#invoices',
        data: {
            isLoading: false,
            isSearchExpanded: true,
            isClosed: false,
            fromDate: null,
            toDate: null,
            invoiceId: null,
            orderId: null,
            poNo: null,
        },
        mounted: function () {
            this.searchInvoices();
        },
        methods: {
            showLoading: function () {
            },
            hideLoading: function () {
            },
            searchInvoices: function () {
                const request = {
                    invoiceId: this.invoiceId,
                    orderId: this.orderId,
                    fromDate: this.fromDate,
                    toDate: this.toDate,
                    pONo: this.poNo,
                    isClosed: this.isClosed,
                };
                this.showLoading();
                const self = this;
                $.ajax({
                    url: "@Url.Action("SearchCompanyInvoices", "Invoice")",
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(request),
                    success: function (data) {
                        self.hideLoading();
                        $('#invoice-grid').html(data);
                    },
                    error: function (xhr, thrownError) {
                        self.hideLoading();
                        console.log(thrownError, 'datadata-error', xhr);
                        $('#invoice-grid').html('an error has occured here');
                    }
                });
            }
        },
    });
</script>
<script>
    $(function () {
        $("#datepicker").datepicker({
            dateFormat: "dd-mm-yy"
            , duration: "fast"
        });
    }); $(function () {
        $("#datepicker2").datepicker({
            dateFormat: "dd-mm-yy"
            , duration: "fast"
        });
    });
</script>
<ejs-scripts></ejs-scripts>